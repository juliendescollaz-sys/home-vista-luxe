; =============================================================================
; PJSIP Configuration pour Neolia Gateway (Raspberry Pi)
; =============================================================================
; Architecture:
;   - Akuvox E12W (interphone) -> s'enregistre ici
;   - Panels Android (Linphone SDK) -> s'enregistrent ici
;   - Quand Akuvox appelle, route vers le panel de l'appartement
; =============================================================================

; -----------------------------------------------------------------------------
; Transport UDP (port 5060)
; -----------------------------------------------------------------------------
[transport-udp]
type=transport
protocol=udp
bind=0.0.0.0:5060

; -----------------------------------------------------------------------------
; Configuration globale
; -----------------------------------------------------------------------------
[global]
type=global
max_forwards=70
user_agent=Neolia-Gateway/1.0
default_outbound_endpoint=akuvox

; -----------------------------------------------------------------------------
; INTERPHONE AKUVOX E12W
; -----------------------------------------------------------------------------
; L'Akuvox s'enregistre avec l'extension 100
; -----------------------------------------------------------------------------

[akuvox]
type=endpoint
context=from-akuvox
disallow=all
allow=ulaw
allow=alaw
allow=opus
direct_media=no
rtp_symmetric=yes
force_rport=yes
rewrite_contact=yes
ice_support=no
auth=akuvox-auth
aors=akuvox

[akuvox-auth]
type=auth
auth_type=userpass
username=100
password=akuvox2024

[akuvox]
type=aor
max_contacts=1
qualify_frequency=30
remove_existing=yes

[akuvox-identify]
type=identify
endpoint=akuvox
match=192.168.1.51

; -----------------------------------------------------------------------------
; TEMPLATE POUR PANELS
; -----------------------------------------------------------------------------
; Chaque panel utilise ce template avec son extension unique
; Format: panel-{apartment_id} (ex: panel-401 pour appartement 401)
; -----------------------------------------------------------------------------

[panel-template](!)
type=endpoint
context=from-panel
disallow=all
allow=ulaw
allow=alaw
allow=opus
direct_media=no
rtp_symmetric=yes
force_rport=yes
rewrite_contact=yes
ice_support=no

[panel-aor-template](!)
type=aor
max_contacts=1
qualify_frequency=60
remove_existing=yes

; -----------------------------------------------------------------------------
; PANELS PRECONFIGURES (exemples)
; -----------------------------------------------------------------------------
; En production, ces sections seront generees dynamiquement par l'API
; -----------------------------------------------------------------------------

; Panel Appartement 401
[panel-401](panel-template)
auth=panel-401-auth
aors=panel-401

[panel-401-auth]
type=auth
auth_type=userpass
username=panel-401
password=neolia401

[panel-401](panel-aor-template)

; Panel Appartement 402
[panel-402](panel-template)
auth=panel-402-auth
aors=panel-402

[panel-402-auth]
type=auth
auth_type=userpass
username=panel-402
password=neolia402

[panel-402](panel-aor-template)

; Panel Appartement 403
[panel-403](panel-template)
auth=panel-403-auth
aors=panel-403

[panel-403-auth]
type=auth
auth_type=userpass
username=panel-403
password=neolia403

[panel-403](panel-aor-template)

; -----------------------------------------------------------------------------
; ENDPOINT DE TEST (pour debug avec softphone)
; -----------------------------------------------------------------------------
[test-softphone]
type=endpoint
context=from-panel
disallow=all
allow=ulaw
allow=alaw
allow=opus
direct_media=no
rtp_symmetric=yes
force_rport=yes
rewrite_contact=yes
auth=test-softphone-auth
aors=test-softphone

[test-softphone-auth]
type=auth
auth_type=userpass
username=test
password=test1234

[test-softphone]
type=aor
max_contacts=1
qualify_frequency=60
