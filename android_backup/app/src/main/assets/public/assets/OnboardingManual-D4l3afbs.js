import{s as p,u as I,i as v,r as o,f as m,j as e,B as d,A as T,n as L,C as M,k as b,m as w,o as S,p as _,L as u,I as x,a as A,Z as U,c as l,q as H}from"./index-DGmE5Y1S.js";const O="https://bl09dhclkeomkczlb0b7ktsssxmevmdq.ui.nabu.casa",R="http://192.168.1.219:8123",Z="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJmMTIyYzA5MGZkOGY0OGZlYjcxZjM5MjgzMjgwZTdmMSIsImlhdCI6MTc2Mjc2OTcxNSwiZXhwIjoyMDc4MTI5NzE1fQ.x7o25AkxgP8PXjTijmXkYOZeMDneeSZVPJT5kUi0emM",z=p().trim().min(10,"URL trop courte").max(500,"URL trop longue").refine(t=>/^https?:\/\//i.test(t)||/^wss?:\/\//i.test(t),"L'URL doit commencer par http://, https://, ws:// ou wss://"),D=p().trim().min(50,"Token trop court").max(1e3,"Token trop long"),J=()=>{const t=I(),{displayMode:h}=v(),g=()=>{const s=localStorage.getItem("neolia_prefill_url");return s?(localStorage.removeItem("neolia_prefill_url"),s):h==="panel"?R:O},f=()=>{const s=localStorage.getItem("neolia_prefill_token");return s?(localStorage.removeItem("neolia_prefill_token"),s):Z},[r,j]=o.useState(g),[a,C]=o.useState(f),[n,i]=o.useState(!1),k=m(s=>s.setConnection),N=m(s=>s.setConnected),y=async()=>{try{z.parse(r),D.parse(a)}catch(s){if(s instanceof U){l.error(s.errors[0].message);return}}i(!0);try{const s=r.trim(),c=a.trim();await H({url:s,token:c}),k({url:s,token:c,connected:!0}),N(!0),l.success("Configuration enregistrée",{description:"Connexion en cours..."}),setTimeout(()=>{t("/")},500)}catch(s){console.error("Erreur lors de l'enregistrement de la configuration:",s),l.error("Erreur lors de l'enregistrement de la configuration")}finally{i(!1)}};return e.jsx("div",{className:"min-h-screen flex flex-col p-4 bg-background",children:e.jsxs("div",{className:"w-full max-w-md mx-auto space-y-8 animate-fade-up",children:[e.jsx("div",{className:"pt-4",children:e.jsxs(d,{variant:"ghost",size:"sm",onClick:()=>t("/onboarding"),className:"gap-2",children:[e.jsx(T,{className:"h-5 w-5"}),"Retour"]})}),e.jsxs("div",{className:"text-center space-y-6",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx("img",{src:L,alt:"Neolia",className:"h-20 w-auto"})}),e.jsx("p",{className:"text-muted-foreground text-lg",children:"Smart Home Premium"})]}),e.jsxs(M,{children:[e.jsxs(b,{children:[e.jsx(w,{children:"Connexion manuelle"}),e.jsx(S,{children:"Configurez votre connexion à Home Assistant"})]}),e.jsxs(_,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"url",children:"URL Home Assistant *"}),e.jsx(x,{id:"url",type:"url",placeholder:"https://xxxxx.ui.nabu.casa",value:r,onChange:s=>j(s.target.value),disabled:n,maxLength:500,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"token",children:"Token Home Assistant *"}),e.jsx(x,{id:"token",type:"password",placeholder:"eyJhbGci...",value:a,onChange:s=>C(s.target.value),disabled:n,maxLength:1e3,required:!0})]}),e.jsx(d,{onClick:y,disabled:n,className:"w-full",size:"lg",children:n?e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"mr-2 h-4 w-4 animate-spin"}),"Connexion en cours..."]}):"Se connecter"})]})]})]})})};export{J as default};
